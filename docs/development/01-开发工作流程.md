# 💻 AgentTest 开发工作流程

面向日常协作者，提供从需求接收到合并上线的标准化流程。所有步骤均以 `main` 分支为基线，默认使用 GitHub 托管。

---

## 1. 准备工作

1. **同步最新代码**
   ```bash
   git checkout main
   git pull origin main
   ```
2. **创建开发分支**：`feature/<模块>-<简短描述>`，示例：`feature/memory-ttl`。
3. **激活虚拟环境并安装依赖**
   ```bash
   python -m venv .venv
   source .venv/bin/activate
   pip install -r requirements.txt
   pip install -r requirements-dev.txt  # 如需执行质量检查
   ```

> 提示：本项目仍在迭代中，`pytest` 目前可能缺少依赖或跳过用例，遇到问题请在 PR 内说明。

---

## 2. 需求拆解与设计

- **对齐目标**：在 Issue/需求单中确认预期行为与验收标准。
- **影响评估**：列出涉及的模块（Agent、Memory、RAG、工具、文档等）。
- **设计沟通**：
  - 小改动：在 PR 描述中附简要设计。
  - 大改动：提交设计文档或在讨论区说明，等待确认后再动手。

---

## 3. 实现编码

### 3.1 通用约定
- 避免在同步代码中直接调用 `asyncio.run`（除顶层入口），使用 `await` 或封装函数。
- 新增公共 API 时在 `src/__init__.py` 或对应包的 `__all__` 中显式导出。
- 代码注释使用中文，必要时保留英文关键词。

### 3.2 常见任务指引
| 任务 | 参考 |
| --- | --- |
| 新增 Agent 能力 | `src/agents/agent.py`（规划工具 → 执行 → 组合响应）|
| 扩展记忆策略 | `src/memory/memory.py` 对应接口，实现自定义存储或评分 |
| 集成外部检索 | 在 `src/rag/rag.py` 里串接第三方服务，保留同名接口 |
| 新增工具 | 使用 `ToolSystem.register_callable` 或自定义 `BaseTool` 子类 |
| 扩展文档 | 对应目录下新增/修改 Markdown，更新 `docs/README.md` 导航 |

---

## 4. 自测与质量检查

1. **运行示例**（确保基础功能正常）
   ```bash
   python examples/quickstart.py
   ```
2. **单元测试**（若新增或修改逻辑）
   ```bash
   pytest tests/unit -q
   ```
3. **编码风格**（若项目已安装相关工具）
   ```bash
   flake8 src/
   mypy src/
   ```
4. **文档同步**：更新涉及的 Markdown，保证链接有效，必要时在 README 中补充说明。

> 无法运行的测试或告警，请在 PR 描述中注明原因与后续计划。

---

## 5. 提交与合并

1. **提交信息**：遵循 `type(scope): description`，示例：`feat(memory): add ttl cleanup`。
2. **推送并创建 PR**：
   - 描述包含：背景/变更要点/测试情况/风险评估。
   - 附带截图或日志有助于 Reviewer 快速确认。
3. **代码评审**：
   - 至少 1 名 Reviewer 通过。
   - 对反馈逐条回复，必要时再次同步主分支解决冲突。
4. **合并策略**：Squash & Merge，保持提交历史整洁。

---

## 6. 发布与复盘（可选）

- **版本号**：遵循 SemVer（示例 `1.1.0`），核心改动时更新 `src/__init__.py`。
- **变更日志**：在 `docs/guides/05-综合总结.md` 或项目 Changelog 记录要点。
- **回滚策略**：保留上一个版本 tag；如生产异常，优先回滚，再排查问题。

---

## 7. 常见问题（FAQ）

| 问题 | 解决方法 |
| --- | --- |
| `pytest` 找不到命令 | 确认激活虚拟环境并安装 `requirements-dev.txt` |
| 异步函数在同步上下文调用 | 使用 `asyncio.run` 包装，或在已有事件循环内用 `await` |
| 文档链接失效 | 更新 `docs/README.md` 和子文档内的相对路径 |
| 引入新依赖 | 在 `requirements*.txt` 中注明版本，并解释引入原因 |

---

*最近更新：2025-11-10 · 维护人：Agent Team*
