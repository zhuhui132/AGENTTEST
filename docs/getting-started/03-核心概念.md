# 🧠 核心概念速览

理解以下术语有助于快速掌握 AgentTest 的模块划分与职责边界。

---

## 1. Agent 与消息

- **Agent**：能够接收消息、访问记忆/工具/知识并返回响应的软件实体。项目内主要使用 `IntelligentAgent`（异步）与 `Agent`（同步包装器）。
- **AgentMessage**：对话消息的数据结构，包含 `role`（user/assistant/system/tool）、正文、时间戳与可选元信息。
- **AgentResponse**：Agent 处理完一条消息后的输出，含响应正文、原因说明、置信度、耗时、引用的记忆/文档/工具等。
- **AgentState**：Agent 当前所处的阶段：`INITIALIZING → IDLE → PROCESSING → ERROR/SHUTDOWN`。

---

## 2. 记忆系统（MemorySystem）

- **MemoryItem**：单条记忆，包含内容、记忆类型、重要性、访问次数与时间戳。
- **MemoryType**：枚举理想中的记忆类别（情景/语义/工作/程序），当前实现以统一方式存储，可根据类型做扩展策略。
- **核心流程**：`add_memory` → `retrieve` → `update_memory` → `delete_memory` → 定期 `cleanup`。
- **评分机制**：相关度（字符串匹配）× 时间衰减 × 重要性 → 以此排序后返回。

扩展建议：接入外部存储（Redis/SQLite/向量库）时，实现同名接口即可无缝替换。

---

## 3. 检索增强生成（RAGSystem）

- **Document**：存储标题、内容、来源、标签等信息的文档模型。
- **工作流**：`add_document` 写入 → `retrieve` 根据关键词相似度检索 → `update/delete` 维护文档 → `rebuild_index` 用于重建索引（默认只更新时间戳）。
- **相似度**：默认基于分词重叠的简单分值，用于示例与测试，可替换为向量相似度（余弦、内积等）。

---

## 4. 工具系统（ToolSystem）

- **ToolRegistration**：记录工具名称、实例和描述。
- **工具类型**：
  - 继承 `BaseTool` 实现 `execute/get_schema/validate_parameters/health_check`
  - 或使用 `register_callable` 将普通函数包装成 `_CallableTool`
- **调用流程**：Agent 根据消息规划 `tool_plans` → `call_tool_async` 执行并返回 `ToolResult`。
- **ToolResult**：工具名、是否成功、输出结果/错误信息、执行时长、元数据。

---

## 5. 上下文管理（ContextManager）

- **ContextInfo**：上下文摘要结构，包含对话窗口、摘要、关键实体、用户意图、附加信息。
- **能力**：
  1. 对最近消息进行截断、摘要
  2. 提取关键词实体（天气/时间/任务等关键词）
  3. 推断意图（question/request/gratitude/unknown）
  4. 支持上下文过期清理
- **使用场景**：Agent 构造 prompt 或记录状态时调用 `build_context / update_context / get_context`。

---

## 6. LLM 层（BaseLLM & 扩展）

- **BaseLLM**：统一的语言模型抽象，定义 `generate`、`generate_stream`、`embed`、`count_tokens`、`initialize` 等方法。
- **LLMWithTools**：在生成前解析提示中的“调用工具意图”，执行工具后再注入结果生成回答。
- **RateLimitedLLM**：为 LLM 请求加上时间窗口限流，避免触发 API 限制。
- **LLMConfig**：模型名称、token 限制、temperature、超时等运行参数。

---

## 7. 配置与工具

- **ConfigManager**：加载 YAML/JSON 配置，缓存结果，支持 Agent/LLM/Memory/Tool/RAG 五类配置。
- **merge_configs**：递归合并基础配置与覆盖配置。
- **get_env_config**：从环境变量读取运行开关（日志级别、是否启用记忆/RAG 等）。
- **get_default_cache**：按环境变量选择内存缓存或 Redis 缓存。

---

## 8. 测试与质量（关键词）

- **pytest**：推荐的测试框架，命令详见 `guides/01-测试方法论.md`
- **flake8 / mypy**：质量检查工具，配置位于 `requirements-dev.txt`
- **覆盖率目标**：单元测试 >85%，集成测试 >70%（参考值，可按团队调整）

---

## 9. 常用术语对照

| 英文 | 中文 | 说明 |
| --- | --- | --- |
| Agent | 智能体 | 接受输入并返回响应的主体 |
| Memory | 记忆系统 | 存储和检索与对话相关的信息 |
| Tool | 工具 | Agent 扩展能力的函数/服务 |
| RAG | 检索增强生成 | 将检索结果注入语言模型提升准确性 |
| Context | 上下文 | 会话历史及衍生信息的集合 |
| Token | Token | LLM 消耗的最小文本单位 |

更多术语请参考 [术语表](../guides/06-术语表.md)。

---

*最近更新：2025-11-10 · 欢迎提交 Issue/PR 补充术语解释*
